class Air{constructor(room){this.serverUrl="wss://air.arraystory.com",this.room=room,this.ws=null,this.listeners={},this.reconnectInterval=null,this.reconnectAttempts=0,this.maxReconnectAttempts=10,this.reconnectDelay=3e3}connect(){const wsUrl=`${this.serverUrl}/ws?channel=${encodeURIComponent(this.room)}`;this.ws=new WebSocket(wsUrl),this.ws.onopen=()=>{this.reconnectAttempts=0,this.reconnectInterval&&(clearInterval(this.reconnectInterval),this.reconnectInterval=null),this._emit("connect",{room:this.room})},this.ws.onmessage=event=>{try{const data=JSON.parse(event.data);this._emit("message",data)}catch(e){this._emit("message",event.data)}},this.ws.onerror=error=>{this._emit("error",error)},this.ws.onclose=event=>{this._emit("disconnect",{code:event.code,reason:event.reason}),this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,this.reconnectInterval=setTimeout(()=>this.connect(),this.reconnectDelay))}}onConnect(callback){return this.on("connect",callback),this}onMessage(callback){return this.on("message",callback),this}onDisconnect(callback){return this.on("disconnect",callback),this}onError(callback){return this.on("error",callback),this}onSent(callback){return this.on("sent",callback),this}send(data){if(this.ws&&this.ws.readyState===WebSocket.OPEN){const payload={channel:this.room,data:data};this.ws.send(JSON.stringify(payload)),this._emit("sent",data)}}on(event,callback){this.listeners[event]||(this.listeners[event]=[]),this.listeners[event].push(callback)}off(event,callback){this.listeners[event]&&(this.listeners[event]=this.listeners[event].filter(cb=>cb!==callback))}disconnect(){this.reconnectInterval&&(clearInterval(this.reconnectInterval),this.reconnectInterval=null),this.ws&&(this.ws.close(),this.ws=null)}isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}_emit(event,data){this.listeners[event]&&this.listeners[event].forEach(callback=>{try{callback(data)}catch(e){console.error(`Error in ${event} listener:`,e)}})}}if(typeof module!=="undefined"&&module.exports){module.exports=Air}if(typeof window!=="undefined"){window.RealtimeClient=Air}
